generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String                @id @default(uuid())
  name                       String
  username                   String                @unique
  email                      String?               @unique
  isActive                   Boolean               @default(true)
  password                   String
  role                       SystemRole            @default(SUPERVISOR)
  createdAt                  DateTime              @default(now())
  updatedAt                  DateTime              @updatedAt
  logs                       Log[]
  notifications              Notification[]
  recruitmentComments        RecruitmentComment[]
  approvedStages             RecruitmentStage[]
  recruitmentTimelineEntries RecruitmentTimeline[]
  requests                   Request[]
  resolvedRequests           Request[]             @relation("RequestResolver")
  vacancies                  Vacancy[]
  participatingVacancies     Vacancy[]             @relation("VacancyParticipants")
  requestStageConfigurations RequestStageConfiguration[]
}

model Log {
  id         String    @id @default(uuid())
  action     String
  details    String
  timestamp  DateTime  @default(now())
  employeeId String?
  userId     String?
  employee   Employee? @relation(fields: [employeeId], references: [id])
  user       User?     @relation(fields: [userId], references: [id])

  @@index([timestamp])
  @@index([employeeId])
  @@index([userId])
}

model Company {
  id        String     @id @default(uuid())
  name      String     @unique
  cnpj      String?    @unique
  address   String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  clients   Client[]
  employees Employee[]
  vacancies Vacancy[]
}

model Client {
  id              String   @id @default(uuid())
  companyId       String?
  name            String
  address         String
  paymentTermDays Int      @default(30)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  company         Company? @relation(fields: [companyId], references: [id])
  postos          Posto[]

  @@index([companyId])
}

model Schedule {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Posto {
  id                String       @id @default(uuid())
  clientId          String
  roleId            String
  startTime         String
  endTime           String
  schedule          String
  billingValue      Float
  requiredWorkload  Int          @default(220)
  isNightShift      Boolean      @default(false)
  baseSalary        Float        @default(0)
  insalubridade     Float        @default(0)
  periculosidade    Float        @default(0)
  gratificacao      Float        @default(0)
  outrosAdicionais  Float        @default(0)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  originAssignments Assignment[] @relation("OriginPosto")
  assignments       Assignment[]
  coverages         Coverage[]
  occurrences       Occurrence[]
  client            Client       @relation(fields: [clientId], references: [id])
  role              Role         @relation(fields: [roleId], references: [id])
  vacancies         Vacancy[]
  scheduleOverrides ScheduleOverride[]

  @@index([clientId])
}

model ScheduleOverride {
  id        String   @id @default(uuid())
  postoId   String
  date      DateTime
  isDayOff  Boolean
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posto     Posto    @relation(fields: [postoId], references: [id])

  @@unique([postoId, date])
  @@index([postoId])
  @@index([date])
}

model Situation {
  id        String     @id @default(uuid())
  name      String     @unique
  color     String     @default("#94a3b8")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  employees Employee[]
}

model Role {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  employees   Employee[]
  postos      Posto[]
  vacancies   Vacancy[]
}

model Employee {
  id                     String              @id @default(uuid())
  name                   String
  cpf                    String              @unique
  roleId                 String
  companyId              String?
  situationId            String?
  status                 String
  type                   String
  birthDate              DateTime?
  gender                 String?
  address                String?
  phone                  String?
  email                  String?
  admissionDate          DateTime            @default(now())
  lastVacationStart      DateTime?
  lastVacationEnd        DateTime?
  totalVacationDaysTaken Int                 @default(0)
  salary                 Float               @default(0)
  insalubridade          Float               @default(0)
  periculosidade         Float               @default(0)
  gratificacao           Float               @default(0)
  outrosAdicionais       Float               @default(0)
  workload               Int                 @default(220)
  valeAlimentacao        Float               @default(0)
  valeTransporte         Float               @default(0)
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  dismissalReason        String?
  dismissalNotes         String?
  probationStatus        String?
  assignments            Assignment[]
  coverages              Coverage[]          @relation("CoveringEmployee")
  company                Company?            @relation(fields: [companyId], references: [id])
  role                   Role                @relation(fields: [roleId], references: [id])
  situation              Situation?          @relation(fields: [situationId], references: [id])
  customAllowances       EmployeeAllowance[]
  logs                   Log[]
  occurrences            Occurrence[]
  requests               Request[]
  vacations              Vacation[]
}

model Vacancy {
  id           String                 @id @default(uuid())
  title        String
  description  String?
  status       VacancyStatus          @default(OPEN)
  priority     String                 @default("MEDIUM")
  postoId      String?
  roleId       String?
  companyId    String?
  recruiterId  String?
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  candidates   RecruitmentCandidate[]
  comments     RecruitmentComment[]
  timelines    RecruitmentTimeline[]
  company      Company?               @relation(fields: [companyId], references: [id])
  posto        Posto?                 @relation(fields: [postoId], references: [id])
  recruiter    User?                  @relation(fields: [recruiterId], references: [id])
  role         Role?                  @relation(fields: [roleId], references: [id])
  participants User[]                 @relation("VacancyParticipants")
}

model RecruitmentComment {
  id        String   @id @default(uuid())
  content   String
  userId    String
  vacancyId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  vacancy   Vacancy  @relation(fields: [vacancyId], references: [id])

  @@index([vacancyId])
}

model Notification {
  id        String   @id @default(uuid())
  title     String
  message   String
  type      String
  link      String?
  read      Boolean  @default(false)
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model RecruitmentCandidate {
  id           String                @id @default(uuid())
  name         String
  email        String?
  phone        String?
  vacancyId    String
  stageId      String
  stageDueDate DateTime?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt
  stage        RecruitmentStage      @relation(fields: [stageId], references: [id])
  vacancy      Vacancy               @relation(fields: [vacancyId], references: [id])
  timeline     RecruitmentTimeline[]
}

model RecruitmentStage {
  id         String                 @id @default(uuid())
  name       String
  order      Int
  isSystem   Boolean                @default(false)
  slaDays    Int                    @default(3)
  approverId String?
  createdAt  DateTime               @default(now())
  updatedAt  DateTime               @updatedAt
  candidates RecruitmentCandidate[]
  approver   User?                  @relation(fields: [approverId], references: [id])
}

model RecruitmentTimeline {
  id            String                @id @default(uuid())
  candidateId   String?
  candidateName String?
  vacancyId     String?
  action        String
  details       String?
  userId        String?
  createdAt     DateTime              @default(now())
  candidate     RecruitmentCandidate? @relation(fields: [candidateId], references: [id])
  user          User?                 @relation(fields: [userId], references: [id])
  vacancy       Vacancy?              @relation(fields: [vacancyId], references: [id])
}

model Vacation {
  id         String   @id @default(uuid())
  employeeId String
  startDate  DateTime
  endDate    DateTime
  daysTaken  Int
  processed  Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([endDate, processed])
}

model AllowanceType {
  id                 String              @id @default(uuid())
  name               String              @unique
  description        String?
  isPercentage       Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  employeeAllowances EmployeeAllowance[]
}

model EmployeeAllowance {
  id              String        @id @default(uuid())
  employeeId      String
  allowanceTypeId String
  value           Float         @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  allowanceType   AllowanceType @relation(fields: [allowanceTypeId], references: [id])
  employee        Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, allowanceTypeId])
}

model Assignment {
  id            String    @id @default(uuid())
  postoId       String
  employeeId    String
  startDate     DateTime
  endDate       DateTime?
  originPostoId String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  employee      Employee  @relation(fields: [employeeId], references: [id])
  originPosto   Posto?    @relation("OriginPosto", fields: [originPostoId], references: [id])
  posto         Posto     @relation(fields: [postoId], references: [id])

  @@index([postoId])
  @@index([employeeId])
  @@index([endDate])
  @@index([originPostoId])
}

model Coverage {
  id                 String    @id @default(uuid())
  postoId            String
  type               String
  date               DateTime
  costValue          Float
  paymentStatus      String
  coveringEmployeeId String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  coveringEmployee   Employee? @relation("CoveringEmployee", fields: [coveringEmployeeId], references: [id])
  posto              Posto     @relation(fields: [postoId], references: [id])

  @@index([postoId])
  @@index([date])
  @@index([type])
}

model Request {
  id              String        @id @default(uuid())
  type            RequestType
  status          RequestStatus @default(PENDENTE)
  dueDate         DateTime
  description     String
  requesterId     String
  employeeId      String?
  resolverId      String?
  resolutionNotes String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  employee        Employee?     @relation(fields: [employeeId], references: [id])
  requester       User          @relation(fields: [requesterId], references: [id])
  resolver        User?         @relation("RequestResolver", fields: [resolverId], references: [id])

  @@index([requesterId])
  @@index([status])
}

model Occurrence {
  id          String    @id @default(uuid())
  title       String
  description String
  type        String
  date        DateTime  @default(now())
  postoId     String
  employeeId  String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  employee    Employee? @relation(fields: [employeeId], references: [id])
  posto       Posto     @relation(fields: [postoId], references: [id])

  @@index([postoId])
  @@index([employeeId])
}

enum SystemRole {
  ADMIN
  COORD_RH
  ASSIST_RH
  SUPERVISOR
}

enum VacancyStatus {
  OPEN
  CLOSED
  HOLD
}

enum RequestType {
  FERIAS
  MOVIMENTACAO
  UNIFORME
  HORARIO
  OUTROS
  TERMINO_CONTRATO_EXPERIENCIA
  TERMINO_CONTRATO_ANTECIPADO
  DEMISSAO_COLABORADOR
  DEMISSAO_EMPRESA
  MUDANCA_ESCALA
  ALTERACAO_FUNCIONAL
}

model RequestStageConfiguration {
  id         String        @id @default(uuid())
  status     RequestStatus @unique
  slaDays    Int           @default(3)
  approverId String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  approver   User?         @relation(fields: [approverId], references: [id])
}

enum RequestStatus {
  PENDENTE
  AGUARDANDO_APROVACAO
  EM_ANALISE_RH
  EM_ANDAMENTO
  CONCLUIDO
  REJEITADO
  CANCELADO
}
